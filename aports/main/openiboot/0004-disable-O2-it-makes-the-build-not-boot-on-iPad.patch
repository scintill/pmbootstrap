From 08270eee04d15b7c8db2b5b1fde8ba2475dea81d Mon Sep 17 00:00:00 2001
From: Joey Hewitt <joey@joeyhewitt.com>
Date: Fri, 30 Mar 2018 15:51:42 -0600
Subject: [PATCH 4/4] disable -O2 - it makes the build not boot (on iPad)

---
 SConstruct    | 2 +-
 framebuffer.c | 6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/SConstruct b/SConstruct
index 0cd2f06..016c3d0 100644
--- a/SConstruct
+++ b/SConstruct
@@ -25,7 +25,7 @@ env.Append(CPPDEFINES=[
 	'OPENIBOOT_VERSION='+version,
 	'OPENIBOOT_VERSION_BUILD='+GetGitCommit(),
 	])
-env.Append(CPPFLAGS = ['-Wall', '-O2', '-Ttext=0x0'])
+env.Append(CPPFLAGS = ['-Wall', '-Ttext=0x0'])
 Export('env')
 
 def localize(env, ls):
diff --git a/framebuffer.c b/framebuffer.c
index 90d73ae..8a7780a 100644
--- a/framebuffer.c
+++ b/framebuffer.c
@@ -56,16 +56,16 @@ static uint32_t ForegroundColor;
 
 #define RGBA2BGR(x) ((((x) >> 16) & 0xFF) | ((((x) >> 8) & 0xFF) << 8) | (((x) & 0xFF) << 16))
 
-inline int getCharPixel(int ch, int x, int y) {
+int getCharPixel(int ch, int x, int y) {
 	register int bitIndex = ((fontWidth * fontHeight) * ch) + (fontWidth * y) + x;
 	return (fontData[bitIndex / 8] >> (bitIndex % 8)) & 0x1;
 }
 
-inline volatile uint32_t* PixelFromCoords(register uint32_t x, register uint32_t y) {
+volatile uint32_t* PixelFromCoords(register uint32_t x, register uint32_t y) {
 	return CurFramebuffer + (y * FBWidth) + x;
 }
 
-inline volatile uint16_t* PixelFromCoords565(register uint32_t x, register uint32_t y) {
+volatile uint16_t* PixelFromCoords565(register uint32_t x, register uint32_t y) {
 	return ((uint16_t*)CurFramebuffer) + (y * FBWidth) + x;
 }
 
-- 
2.7.4

